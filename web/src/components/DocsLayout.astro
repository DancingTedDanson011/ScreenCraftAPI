---
import Layout from '../layouts/Layout.astro';
import Navbar from './Navbar.astro';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'ScreenCraft API Documentation' } = Astro.props;

const currentPath = Astro.url.pathname;

const docsNav = [
  { title: 'Getting Started', items: [
    { name: 'Overview', href: '/docs' },
    { name: 'Quickstart', href: '/docs/quickstart' },
  ]},
  { title: 'API Reference', items: [
    { name: 'Screenshots', href: '/docs/screenshots' },
    { name: 'PDFs', href: '/docs/pdfs' },
    { name: 'Webhooks', href: '/docs/webhooks' },
  ]},
  { title: 'Resources', items: [
    { name: 'Error Codes', href: '/docs/errors' },
    { name: 'Changelog', href: '/changelog' },
    { name: 'Status', href: '/status' },
  ]},
];

function isActive(href: string): boolean {
  if (href === '/docs') {
    return currentPath === '/docs' || currentPath === '/docs/';
  }
  return currentPath.startsWith(href);
}
---

<Layout title={`${title} | ScreenCraft Docs`} description={description}>
  <Navbar />
  <div class="min-h-screen bg-background">
    <!-- Mobile Docs Sidebar Toggle -->
    <div class="lg:hidden sticky top-0 z-40 bg-surface border-b border-border px-4 py-3">
      <div class="flex items-center justify-between">
        <span class="text-sm font-medium text-text-secondary">Documentation</span>
        <button id="mobile-menu-btn" class="p-2 text-text-secondary hover:text-text-primary flex items-center gap-2">
          <span class="text-sm">Menu</span>
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="lg:hidden fixed inset-0 z-40 hidden">
      <div class="absolute inset-0 bg-black/50" id="mobile-menu-overlay"></div>
      <aside class="absolute left-0 top-0 bottom-0 w-64 bg-surface border-r border-border overflow-y-auto">
        <div class="p-4">
          <button id="mobile-menu-close" class="mb-4 p-2 text-text-secondary hover:text-text-primary">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
          <nav>
            {docsNav.map(section => (
              <div class="mb-6">
                <h3 class="text-sm font-semibold text-text-muted uppercase tracking-wider mb-2">
                  {section.title}
                </h3>
                <ul class="space-y-1">
                  {section.items.map(item => (
                    <li>
                      <a
                        href={item.href}
                        class:list={[
                          "block px-3 py-2 rounded-md transition",
                          isActive(item.href)
                            ? "bg-accent-primary/10 text-accent-primary border-l-2 border-accent-primary"
                            : "text-text-secondary hover:text-text-primary hover:bg-surface-hover"
                        ]}
                      >
                        {item.name}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </nav>
        </div>
      </aside>
    </div>

    <div class="max-w-7xl mx-auto px-4 py-8 flex gap-8">
      <!-- Desktop Sidebar -->
      <aside class="w-64 flex-shrink-0 hidden lg:block">
        <div class="sticky top-8">
          <a href="/" class="flex items-center gap-2 mb-8">
            <svg class="w-8 h-8 text-accent-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <span class="font-semibold text-text-primary">ScreenCraft Docs</span>
          </a>
          <nav>
            {docsNav.map(section => (
              <div class="mb-6">
                <h3 class="text-sm font-semibold text-text-muted uppercase tracking-wider mb-2">
                  {section.title}
                </h3>
                <ul class="space-y-1">
                  {section.items.map(item => (
                    <li>
                      <a
                        href={item.href}
                        class:list={[
                          "block px-3 py-2 rounded-md transition",
                          isActive(item.href)
                            ? "bg-accent-primary/10 text-accent-primary border-l-2 border-accent-primary"
                            : "text-text-secondary hover:text-text-primary hover:bg-surface-hover"
                        ]}
                      >
                        {item.name}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </nav>
        </div>
      </aside>

      <!-- Content -->
      <main class="flex-1 min-w-0">
        <article class="prose prose-lg prose-invert max-w-none">
          <slot />
        </article>
      </main>
    </div>
  </div>

  <script>
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const mobileMenuClose = document.getElementById('mobile-menu-close');
    const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');

    function openMenu() {
      mobileMenu?.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closeMenu() {
      mobileMenu?.classList.add('hidden');
      document.body.style.overflow = '';
    }

    mobileMenuBtn?.addEventListener('click', openMenu);
    mobileMenuClose?.addEventListener('click', closeMenu);
    mobileMenuOverlay?.addEventListener('click', closeMenu);
  </script>
</Layout>

<style>
  /* Base prose styling */
  .prose {
    color: #8B949E;
    line-height: 1.75;
  }

  /* Heading styles with proper spacing */
  .prose :global(h1) {
    margin-top: 0;
    margin-bottom: 1.5rem;
    font-size: 2.25rem;
    font-weight: 700;
    line-height: 1.2;
    color: #F0F6FC;
  }

  .prose :global(h2) {
    margin-top: 3rem;
    margin-bottom: 1.5rem;
    font-size: 1.75rem;
    font-weight: 600;
    line-height: 1.3;
    color: #F0F6FC;
    scroll-margin-top: 6rem;
  }

  .prose :global(h3) {
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    font-size: 1.375rem;
    font-weight: 600;
    line-height: 1.4;
    color: #F0F6FC;
    scroll-margin-top: 6rem;
  }

  .prose :global(h4) {
    margin-top: 2rem;
    margin-bottom: 0.875rem;
    font-size: 1.125rem;
    font-weight: 600;
    color: #F0F6FC;
  }

  /* Paragraph spacing */
  .prose :global(p) {
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
  }

  /* List spacing */
  .prose :global(ul),
  .prose :global(ol) {
    margin-top: 1.5rem;
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
  }

  .prose :global(ul > li),
  .prose :global(ol > li) {
    margin-top: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .prose :global(li > ul),
  .prose :global(li > ol) {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }

  /* Code block styling */
  .prose :global(pre) {
    margin-top: 2rem;
    margin-bottom: 2rem;
    padding: 1.25rem;
    background-color: #161B22;
    border: 1px solid #30363D;
    border-radius: 0.5rem;
    overflow-x: auto;
  }

  .prose :global(code) {
    color: #1F6FEB;
    background-color: rgba(31, 111, 235, 0.1);
    padding: 0.2rem 0.4rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
  }

  .prose :global(pre code) {
    background-color: transparent;
    padding: 0;
    color: #F0F6FC;
    font-size: 0.875rem;
  }

  /* Link styling */
  .prose :global(a) {
    color: #1F6FEB;
    text-decoration: none;
  }

  .prose :global(a:hover) {
    text-decoration: underline;
  }

  /* Strong text */
  .prose :global(strong) {
    color: #F0F6FC;
    font-weight: 600;
  }

  /* Blockquote */
  .prose :global(blockquote) {
    margin-top: 2rem;
    margin-bottom: 2rem;
    padding-left: 1.25rem;
    border-left: 3px solid #30363D;
    color: #8B949E;
    font-style: italic;
  }

  /* Table styling */
  .prose :global(table) {
    margin-top: 2rem;
    margin-bottom: 2rem;
    width: 100%;
    border-collapse: collapse;
  }

  .prose :global(th),
  .prose :global(td) {
    padding: 0.75rem 1rem;
    border: 1px solid #30363D;
    text-align: left;
  }

  .prose :global(th) {
    background-color: #161B22;
    color: #F0F6FC;
    font-weight: 600;
  }

  /* HR styling */
  .prose :global(hr) {
    margin-top: 3rem;
    margin-bottom: 3rem;
    border: none;
    border-top: 1px solid #30363D;
  }

  /* Image styling */
  .prose :global(img) {
    margin-top: 2rem;
    margin-bottom: 2rem;
    border-radius: 0.5rem;
  }

  /* First/Last element margin fixes */
  .prose :global(> :first-child) {
    margin-top: 0;
  }

  .prose :global(> :last-child) {
    margin-bottom: 0;
  }
</style>
